# Introduction #


$Revision: 2.0 $ $Date: 21-Apr-2010
Tested in MATLAB 7.9.0.529 (R2009b) and Octave 3.2.3 and Hypre 2.6.0b.

Download http://www.mathworks.com/matlabcentral/fileexchange/27279-laplacian-in-1d-2d-or-3d and matlab2hypre package from http://www.mathworks.com/matlabcentral/fileexchange/27437-matlab2hypre-and-hypre2matlab

Install hypre.

# Test 1: Reading in the matrix. #


In Matlab or OCTAVE
<pre>
% Construct a 3D Laplacian matrix and calculate the 20 smallest eigenvalues<br>
% from an exact formula.<br>
>> [A, lambda] = laplacian([20,30,40], {'DD','DN','P'}, 20);<br>
<br>
<br>
Elapsed time is 0.139952 seconds.<br>
Matrix is 2816008 bytes<br>
<br>
% convert the matrix A to Hypre format.<br>
>> matlab2hypreIJ(A,4,'matrixA','1.0d');<br>
Generating file: matrixA.00000<br>
Generating file: matrixA.00001<br>
Generating file: matrixA.00002<br>
Generating file: matrixA.00003<br>
<br>
The input argument equal to 4 specifies the number of processors.<br>
The '1.0d' input will write the matrix files with only one digit for each entry,<br>
which is OK for this specific matrix which only has integer values between -1 and 6.<br>
<br>
<br>
Now, go into your local directory and copy the files "matrixA." to $HYPREDIR/src/test.<br>
You can also save the files directly to that directory by code similar to the following:<br>
<br>
>> matlab2hypreIJ(A,4,'/home/hypre/src/test/matrixA','1.0d');<br>
<br>
Go to that directory and execute the following to compute the 20 smallest eigenvalues:<br>
<br>
$ mpirun -np 4 ./ij -lobpcg -fromfile matrixA -vrand 20<br>
<br>
Computes the 20 smallest eigenvalues of matrixA using random initial vectors.<br>
These eigenvalues should be close to those computed from laplacian.m.<br>
</pre>


## Test 2. Outputing Eigenvectors from Hypre. ##

In Matlab or OCTAVE
<pre>

>> [A, lambda, V] = laplacian([20,30,40], {'DD','DN','P'}, 20);<br>
>> matlab2hypreIJ(A,4,'matrixA','1.0d');<br>
<br>
Go into your local directory and copy the files "matrixA." to $HYPREDIR/src/test.<br>
Go to that directory and execute:<br>
<br>
$ mpirun -np 4 ./ij -lobpcg -fromfile matrixA -vrand 20 -vout 1<br>
<br>
The -vout 1 command will output the eigenvectors into files called "vectors.".<br>
Then copy "vectors." to the local MATLAB directory, and in Matlab,<br>
<br>
>> V2 = hypreParVectors2matlab('vectors');<br>
<br>
You could also do this without copying the vectors files if you replace<br>
the input 'vectors' with the Hypre IJ directory. For example,<br>
<br>
>> V2 = hypreParVectors2matlab('/home/hypre/src/test/vectors');<br>
<br>
Test the eigenvectors by computing the product of V' and V2.<br>
<br>
</pre>

## Test 3. Inputing Initial Vectors into Hypre from a file ##

<pre>
You can also generate initial vectors in Matlab or OCTAVE and read them in the Hypre IJ driver.<br>
In the following example, I have used the eigenvectors generated by laplacian.m,<br>
so one can verify that convergence happens in just a few steps by using eigenvectors as initial vectors.<br>
<br>
In Matlab or OCTAVE<br>
<br>
>> [A, lambda, V] = laplacian([20,30,40], {'DD','DN','P'}, 20);<br>
>> matlab2hypreParVectors(V,4,'/home/hypre/src/test/vectors');<br>
<br>
Hypre can only input initial vectors with the filename prefix "vectors".<br>
<br>
In the Hypre directory, type the following:<br>
<br>
$ mpirun -np 4 ./ij -lobpcg -fromfile matrixA -vfromfile<br>
<br>
The -vfromfile argument will read initial vectors with filename prefix "vectors"<br>
contained in the local directory. If you use the eigenvectors generated by laplacian.m,<br>
you will see convergence in just a few steps.<br>
</pre>